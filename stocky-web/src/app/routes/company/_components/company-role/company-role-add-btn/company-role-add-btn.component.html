<app-button
    [props]="{
        icon: props.icon,
        size: props.size,
        title: props.title,
        handler: isDrawer ?  onOpenDrawer: onOpenModal
    }"
></app-button>

<ng-container *ngIf="isDrawer; else modalTmpl">
    <nz-drawer
        (nzOnClose)="onCloseDrawer()"
        [nzBodyStyle]="{ overflow: 'auto' }"
        [nzFooter]="footerTpl"
        [nzMaskClosable]="false"
        [nzVisible]="showDrawer"
        [nzWidth]="720"
        nzTitle="Create"
    >
        <div *nzDrawerContent>
            <ng-container [ngTemplateOutletContext]="{form: categoryForm}" [ngTemplateOutlet]="contentFormTmpl"></ng-container>
        </div>

        <ng-template #footerTpl>
            <div class="fr">
                <button (click)="onCloseDrawer()" nz-button style="margin-right: 8px;">Cancel</button>
                <button (click)="onCloseDrawer()" nz-button nzType="primary">Submit</button>
            </div>
        </ng-template>
    </nz-drawer>
</ng-container>

<ng-template #modalTmpl>
    <nz-modal
        (nzOnCancel)="onCloseModal()"
        (nzOnOk)="onCreate()"
        [(nzVisible)]="showModal"
        [nzMaskClosable]="false"
        nzTitle="Create"
    >
        <div *nzModalContent [nzLg]="{ span: 24, offset: 0 }" [nzXs]="{ span: 24, offset: 0 }" nz-col>
            <ng-container [ngTemplateOutletContext]="{form: categoryForm}" [ngTemplateOutlet]="contentFormTmpl"></ng-container>
        </div>
        <div *nzModalFooter>
            <ng-container [ngTemplateOutlet]="contentFooterBtnTmpl"></ng-container>
        </div>

    </nz-modal>
</ng-template>

<ng-template #contentFormTmpl let-form="form">
    <form (submit)="onCreate()"
          autocomplete="off"
          nz-form
          nzLayout="vertical"
    >
        <div [nzSpan]="24" nz-col>

            <nz-form-item>
                <nz-form-label>Title</nz-form-label>
                <nz-form-control nzErrorTip="Role title is required">
                    <input
                        name="title"
                        nz-input
                        placeholder="Enter role title"
                        type="text"
                    />
                </nz-form-control>
            </nz-form-item>

            <app-textarea-limit [props]="{showLabel: true, labelText: 'Description'}"></app-textarea-limit>

            <ng-container
                [ngTemplateOutletContext]="{permissions: permissions}"
                [ngTemplateOutlet]="isDrawer ? permDrawerTmpl: permsModalTmpl"
            ></ng-container>

        </div>

    </form>
</ng-template>

<ng-template #contentFooterBtnTmpl>
    <button (click)="onCloseModal()" nz-button nzType="default">Cancel</button>
    <button (click)="onCreate()" [nzLoading]="isLoading" nz-button nzType="primary">Submit</button>
</ng-template>


<ng-template #permsModalTmpl let-permissions="permissions">
    <nz-form-item>
        <nz-form-label>Permissions</nz-form-label>
        <nz-form-control nzErrorTip="Select at least 1 permission">
            <nz-select nzMode="multiple" nzPlaceHolder="Select permissions">
                <nz-option></nz-option>
            </nz-select>
        </nz-form-control>
    </nz-form-item>
</ng-template>

<ng-template #permDrawerTmpl let-permissions="permissions">

    <nz-form-item class="space-t">
        <nz-form-label>Permissions</nz-form-label>

        <nz-collapse nzAccordion>
            <nz-collapse-panel *ngFor="let panel of permissions" [nzActive]="panel.active" [nzHeader]="panel.name">
                <p>{{ panel.name }} content</p>
            </nz-collapse-panel>
        </nz-collapse>
    </nz-form-item>

</ng-template>

